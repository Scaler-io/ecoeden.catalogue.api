# build.yml
parameters:
  - name: imageName
    type: string
  - name: dockerHubServiceConnection
    type: string

steps:
  # Install Docker (optional if Docker is already available on the agent)
  - task: DockerInstaller@0
    inputs:
      dockerVersion: "latest" # Specify the latest version you need

  # Clean Docker system
  - script: |
      docker system prune -a -f
    displayName: "Clean Docker System"

  # Build Docker image
  - script: |
      docker build --progress=plain --no-cache -f src/Ecoeden.Catalogue.Api/Dockerfile -t sharthak1995/ecoeden-catalogue-svc:213 .
    displayName: "Build Docker Image"

  # Log in to Docker registry
  # - script: |
  #     echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin your-docker-registry
  #   displayName: "Log in to Docker Registry"
  #   env:
  #     DOCKER_USERNAME: $(DOCKER_USERNAME)
  #     DOCKER_PASSWORD: $(DOCKER_PASSWORD)

  # # Push Docker image
  # - script: |
  #     docker push your-docker-registry/ecoeden-catalogue-svc:213
  #   displayName: "Push Docker Image"
