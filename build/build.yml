# build.yml
parameters:
  - name: imageName
    type: string
  - name: dockerHubServiceConnection
    type: string

steps:
  - script: |
      dotnet --list-sdks
    displayName: "List all dotnet sdks"

  - task: DotNetCoreCLI@2
    inputs:
      command: "build"
      projects: "**/*.sln"
      arguments: "--configuration Release"

  - task: Docker@2
    inputs:
      containerRegistry: "$(dockerHubServiceConnection)"
      repository: "$(imageName)"
      command: "buildAndPush"
      Dockerfile: "**/Dockerfile"
      tags: |
        $(Build.BuildId)

  - task: PublishBuildArtifacts@1
    inputs:
      PathtoPublish: "$(Build.ArtifactStagingDirectory)"
      ArtifactName: "drop"
      publishLocation: "Container"
