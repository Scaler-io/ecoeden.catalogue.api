# build.yml
parameters:
  - name: imageName
    type: string
  - name: dockerHubServiceConnection
    type: string

steps:
  # - task: NuGetCommand@2
  #   displayName: "Restore solution"
  #   inputs:
  #     command: "restore"
  #     restoreSolution: "**/*.sln"
  #     feedsToUse: "select"

  # - task: DotNetCoreCLI@2
  #   displayName: "Build solution"
  #   inputs:
  #     command: "build"
  #     projects: "**/*.sln"
  #     arguments: "--configuration Release"

  - task: Docker@2
    inputs:
      containerRegistry: "$(dockerHubServiceConnection)"
      repository: "$(imageName)"
      command: "buildAndPush"
      Dockerfile: "**/Dockerfile"
      buildContext: "$(Build.SourcesDirectory)"
      tags: |
        $(Build.BuildId)

  - task: PublishBuildArtifacts@1
    inputs:
      PathtoPublish: "$(Build.ArtifactStagingDirectory)"
      ArtifactName: "drop"
      publishLocation: "Container"
